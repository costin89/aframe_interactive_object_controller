<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>A-Frame Scene with Object Orbit Component</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script>
  AFRAME.registerComponent('interactive-controls', {
    schema: {
      speed: {type: 'number', default: 1},
      zoomSpeed: {type: 'number', default: 0.01},
      minScale: {type: 'number', default: 0.5},
      maxScale: {type: 'number', default: 2.0}
    },
    init: function() {
      // Initialisieren von Zust√§nden und Variablen
      this.isMouseDown = false;
      this.lastPosition = {x: 0, y: 0};
      this.lastTouchDistance = null;

      this.bindMethods();
    },
    bindMethods: function() {
      const el = this.el;
      const data = this.data;

      // Maus-Events
      window.addEventListener('mousedown', this.onMouseDown.bind(this));
      window.addEventListener('mousemove', this.onMouseMove.bind(this));
      window.addEventListener('mouseup', this.onMouseUp.bind(this));

      // Touch-Events
      el.addEventListener('touchstart', this.onTouchStart.bind(this), {passive: true});
      el.addEventListener('touchmove', this.onTouchMove.bind(this), {passive: true});
      el.addEventListener('touchend', this.onTouchEnd.bind(this));

      // Click zum Ermitteln von Doppelklick
      el.addEventListener('click', this.onClick.bind(this));

      // Scrollrad zum Zoomen
      window.addEventListener('wheel', this.onWheel.bind(this));
    },
    onMouseDown: function(event) {
      this.isMouseDown = true;
      this.lastPosition.x = event.clientX;
      this.lastPosition.y = event.clientY;
    },
    onMouseMove: function(event) {
      if (!this.isMouseDown) return;
      this.rotateObject(event.clientX, event.clientY);
    },
    onMouseUp: function() {
      this.isMouseDown = false;
    },
    onTouchStart: function(event) {
      if (event.touches.length === 1) {
        this.lastPosition.x = event.touches[0].clientX;
        this.lastPosition.y = event.touches[0].clientY;
      } else if (event.touches.length === 2) {
        this.lastTouchDistance = this.getTouchDistance(event.touches);
      }
    },
    onTouchMove: function(event) {
      if (event.touches.length === 1) {
        this.rotateObject(event.touches[0].clientX, event.touches[0].clientY);
      } else if (event.touches.length === 2) {
        const currentDistance = this.getTouchDistance(event.touches);
        this.scaleObject(currentDistance);
      }
    },
    onTouchEnd: function() {
      this.lastTouchDistance = null;
    },
    onClick: function() {
      const currentTime = new Date().getTime();
      if (currentTime - this.lastClickTime < 500) {
        this.el.setAttribute('rotation', {x: 0, y: 0, z: 0});
      }
      this.lastClickTime = currentTime;
    },
    onWheel: function(event) {
      let scale = this.el.getAttribute('scale');
      let zoomFactor = event.deltaY * -this.data.zoomSpeed;
      this.applyScale(scale.x + zoomFactor, scale.y + zoomFactor, scale.z + zoomFactor);
    },
    rotateObject: function(clientX, clientY) {
      let diffX = clientX - this.lastPosition.x;
      let diffY = clientY - this.lastPosition.y;
      this.lastPosition.x = clientX;
      this.lastPosition.y = clientY;

      let rotation = this.el.getAttribute('rotation');
      rotation.y += diffX * this.data.speed;
      rotation.x -= diffY * this.data.speed;
      this.el.setAttribute('rotation', rotation);
    },
    scaleObject: function(currentDistance) {
      if (this.lastTouchDistance === null) return;
      let scale = this.el.getAttribute('scale');
      let scaleChange = currentDistance / this.lastTouchDistance;
      this.applyScale(scale.x * scaleChange, scale.y * scaleChange, scale.z * scaleChange);
    },
    applyScale: function(x, y, z) {
      const {minScale, maxScale} = this.data;
      x = Math.max(minScale, Math.min(maxScale, x));
      y = Math.max(minScale, Math.min(maxScale, y));
      z = Math.max(minScale, Math.min(maxScale, z));
      this.el.setAttribute('scale', {x, y, z});
    },
    getTouchDistance: function(touches) {
      const dx = touches[0].clientX - touches[1].clientX;
      const dy = touches[0].clientY - touches[1].clientY;
      return Math.sqrt(dx * dx + dy * dy);
    }
  });
</script>
</head>
<body>
    <a-scene>
        <a-box position="0 1.5 -5" rotation="0 0 0" color="#4CC3D9" interactive-controls="speed: 0.1; zoomSpeed: 0.005; minScale: 0.5; maxScale: 2.0"></a-box>
        <a-entity camera look-controls="false" position="0 1.6 0">
          <a-cursor id="cursor" color="red" fuse="false"></a-cursor>
        </a-entity>
    </a-scene>
</body>
</html>
