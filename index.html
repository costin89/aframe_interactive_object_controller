<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>A-Frame Scene with Object Orbit Component</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script>
    AFRAME.registerComponent('cursor-drag-rotate', {
      schema: {
        speed: {type: 'number', default: 1}, // Geschwindigkeit der Drehung
        zoomSpeed: {type: 'number', default: 0.1}, // Geschwindigkeit des Zooms
        minScale: {type: 'number', default: 1.0}, // Minimale Skalierung
        maxScale: {type: 'number', default: 2.0} // Maximale Skalierung
      },
      init: function() {
        this.isMouseDown = false;
        this.isTouching = false;
        this.isMouseOver = false;
        this.startX = 0;
        this.startY = 0;
        this.lastTouchDistance = null;
        this.lastClickTime = 0;
        const el = this.el;
        const data = this.data;
        
        el.addEventListener('mouseenter', () => this.isMouseOver = true);
        el.addEventListener('mouseleave', () => this.isMouseOver = false);
        
        // Maus-Events
        window.addEventListener('mousedown', (event) => {
          if (this.isMouseOver) {
            this.isMouseDown = true;
            this.startX = event.clientX;
            this.startY = event.clientY;
          }
        });
        
        window.addEventListener('mousemove', (event) => {
          if (this.isMouseDown && this.isMouseOver) {
            this.handleMovement(event.clientX, event.clientY);
          }
        });
        
        window.addEventListener('mouseup', () => this.isMouseDown = false);
        
        // Touch-Events
        el.addEventListener('touchstart', (event) => {
          if (event.touches.length === 1) {
            this.isTouching = true;
            this.startX = event.touches[0].clientX;
            this.startY = event.touches[0].clientY;
          } else if (event.touches.length === 2) {
            this.lastTouchDistance = this.getDistance(event.touches[0], event.touches[1]);
          }
        }, {passive: true});
        
        el.addEventListener('touchmove', (event) => {
          if (this.isTouching && event.touches.length === 1) {
            this.handleMovement(event.touches[0].clientX, event.touches[0].clientY);
          } else if (event.touches.length === 2) {
            const currentDistance = this.getDistance(event.touches[0], event.touches[1]);
            if (this.lastTouchDistance !== null) {
              let scaleChange = (currentDistance - this.lastTouchDistance) * data.zoomSpeed * 0.01;
              this.handleZoom(scaleChange);
            }
            this.lastTouchDistance = currentDistance;
          }
          event.preventDefault();
        }, {passive: false});
        
        el.addEventListener('touchend', () => {
          this.isTouching = false;
          this.lastTouchDistance = null;
        });
        
        // Zoom-FunktionalitÃ¤t mit dem Mausrad
        window.addEventListener('wheel', (event) => {
          if (this.isMouseOver) {
            let zoomFactor = event.deltaY * -data.zoomSpeed;
            this.handleZoom(zoomFactor);
          }
        });

        // Hilfsfunktionen
        this.handleMovement = (clientX, clientY) => {
          let diffX = clientX - this.startX;
          let diffY = clientY - this.startY;
          this.startX = clientX;
          this.startY = clientY;
          
          let rotation = el.getAttribute('rotation');
          rotation.y += diffX * data.speed;
          rotation.x -= diffY * data.speed;
          el.setAttribute('rotation', rotation);
        };

        this.handleZoom = (zoomFactor) => {
          let scale = el.getAttribute('scale');
          scale.x = Math.max(data.minScale, Math.min(data.maxScale, scale.x + zoomFactor));
          scale.y = Math.max(data.minScale, Math.min(data.maxScale, scale.y + zoomFactor));
          scale.z = Math.max(data.minScale, Math.min(data.maxScale, scale.z + zoomFactor));
          el.setAttribute('scale', scale);
        };

        this.getDistance = (touch1, touch2) => {
          const dx = touch1.clientX - touch2.clientX;
          const dy = touch1.clientY - touch2.clientY;
          return Math.sqrt(dx * dx + dy * dy);
        };
      }
    });
  </script>
</head>
<body>
    <a-scene xr-mode-ui="enabled: false">
      <a-box position="0 1.5 -5" rotation="0 0 0" color="#4CC3D9" cursor-drag-rotate="speed: 0.1; zoomSpeed: 0.05; minScale: 1.0; maxScale: 2.0"></a-box>
        <a-entity camera look-controls="false" cursor-visible="false" position="0 1.6 0">
          <a-cursor id="cursor" color="red" fuse="true" visible="false"></a-cursor>
        </a-entity>
    </a-scene>
</body>
</html>
